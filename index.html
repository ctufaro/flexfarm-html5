<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flex Farm â€“ Whimsy Harvest</title>
  <style>
    :root {
      color-scheme: light;
      font-family: "Trebuchet MS", "Comic Sans MS", system-ui, sans-serif;
      --sky: #bfe9ff;
      --grass: #84d27d;
      --grass-dark: #6bb867;
      --soil: #b5754e;
      --soil-dark: #8d5637;
      --accent: #ffcf5c;
      --panel: rgba(255, 255, 255, 0.85);
      --ink: #2a2a2a;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: linear-gradient(180deg, var(--sky) 0%, #e8f6ff 45%, #fdf6e8 100%);
      color: var(--ink);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
    }

    header h1 {
      font-size: 1.5rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    header h1 span {
      font-size: 1.1rem;
      background: var(--accent);
      padding: 4px 10px;
      border-radius: 999px;
    }

    .hud {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .hud .pill {
      background: var(--panel);
      padding: 6px 12px;
      border-radius: 999px;
      font-weight: 600;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
    }

    main {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(260px, 320px);
      gap: 18px;
      padding: 0 24px 24px;
      align-items: stretch;
    }

    .play-area {
      position: relative;
      background: linear-gradient(180deg, #ffffff 0%, #f5ffef 100%);
      border-radius: 24px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.15);
      overflow: hidden;
      min-height: 520px;
      display: flex;
      align-items: stretch;
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .panel {
      background: var(--panel);
      border-radius: 20px;
      padding: 18px;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.12);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .panel h2 {
      margin: 0;
      font-size: 1.1rem;
    }

    .panel p {
      margin: 0;
      line-height: 1.4;
    }

    .legend {
      display: grid;
      gap: 10px;
      font-size: 0.95rem;
    }

    .legend span {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
    }

    .btn-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 10px 16px;
      background: #2a2a2a;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }

    button.secondary {
      background: #ffffff;
      color: #2a2a2a;
      border: 2px solid #2a2a2a;
    }

    .toast {
      position: absolute;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.9);
      padding: 10px 18px;
      border-radius: 999px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.18);
      font-weight: 600;
      opacity: 0;
      transition: opacity 0.25s ease, transform 0.25s ease;
      pointer-events: none;
    }

    .toast.show {
      opacity: 1;
      transform: translate(-50%, -4px);
    }

    .splash {
      position: absolute;
      inset: 0;
      background: linear-gradient(140deg, rgba(255, 255, 255, 0.92), rgba(255, 244, 208, 0.95));
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 24px;
      gap: 16px;
    }

    .splash h2 {
      font-size: 2rem;
      margin: 0;
    }

    .splash p {
      max-width: 360px;
      margin: 0;
    }

    @media (max-width: 900px) {
      main {
        grid-template-columns: 1fr;
      }

      .play-area {
        min-height: 460px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Flex Farm <span>Whimsy Harvest</span></h1>
    <div class="hud">
      <div class="pill">Harvested: <strong id="stat-harvested">0</strong></div>
      <div class="pill">Combo: <strong id="stat-combo">0</strong>x</div>
    </div>
  </header>

  <main>
    <section class="play-area">
      <canvas id="game-canvas" width="960" height="640"></canvas>
      <div class="toast" id="toast">Yay!</div>
      <div class="splash" id="splash">
        <h2>Welcome to Whimsy Harvest</h2>
        <p>Stroll the meadow, click a crop, and give it a gentle tug. Pull up enough crops to light up the field!</p>
        <div class="btn-row">
          <button id="start-btn">Start Harvesting</button>
          <button id="how-btn" class="secondary">How to Play</button>
        </div>
      </div>
    </section>

    <aside class="panel">
      <h2>How it works</h2>
      <p>Click crops to pull them up. Each crop you harvest pops a little sparkle and refreshes somewhere new.</p>
      <div class="legend">
        <span><span class="dot" style="background: #f9a65a;"></span> Carrot pops (+1)</span>
        <span><span class="dot" style="background: #f26d6d;"></span> Tomato pops (+2)</span>
        <span><span class="dot" style="background: #7cc576;"></span> Lettuce pops (+1)</span>
        <span><span class="dot" style="background: #ffd166;"></span> Golden beet (combo bonus)</span>
      </div>
      <p>Keep an eye out for the golden beet to boost your combo meter!</p>
      <div class="btn-row">
        <button id="reset-btn" class="secondary">Reset Field</button>
      </div>
    </aside>
  </main>

  <script>
    const canvas = document.getElementById("game-canvas");
    const ctx = canvas.getContext("2d");
    const toast = document.getElementById("toast");
    const splash = document.getElementById("splash");
    const startBtn = document.getElementById("start-btn");
    const howBtn = document.getElementById("how-btn");
    const resetBtn = document.getElementById("reset-btn");
    const statHarvested = document.getElementById("stat-harvested");
    const statCombo = document.getElementById("stat-combo");

    const state = {
      crops: [],
      particles: [],
      harvested: 0,
      combo: 0,
      showSplash: true,
      tutorialMode: false,
      lastHarvestTime: 0,
      hoveredCrop: null,
    };

    const cropTypes = [
      {
        name: "Carrot",
        color: "#f9a65a",
        stem: "#6fbf73",
        value: 1,
        weight: 4,
      },
      {
        name: "Tomato",
        color: "#f26d6d",
        stem: "#6fbf73",
        value: 2,
        weight: 3,
      },
      {
        name: "Lettuce",
        color: "#7cc576",
        stem: "#4a9c5d",
        value: 1,
        weight: 3,
      },
      {
        name: "Golden Beet",
        color: "#ffd166",
        stem: "#9c7b29",
        value: 3,
        weight: 1,
        golden: true,
      },
    ];

    const field = {
      width: canvas.width,
      height: canvas.height,
      center: { x: canvas.width / 2, y: canvas.height / 2 },
    };

    const rngPick = (list) => {
      const total = list.reduce((sum, item) => sum + item.weight, 0);
      let roll = Math.random() * total;
      return list.find((item) => {
        roll -= item.weight;
        return roll <= 0;
      });
    };

    const showToast = (message) => {
      toast.textContent = message;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 1100);
    };

    const spawnCrop = () => {
      const type = rngPick(cropTypes);
      const margin = 80;
      const crop = {
        id: Math.random().toString(36).slice(2),
        type,
        x: margin + Math.random() * (field.width - margin * 2),
        y: margin + Math.random() * (field.height - margin * 2),
        size: 18 + Math.random() * 10,
        bobOffset: Math.random() * Math.PI * 2,
      };
      state.crops.push(crop);
    };

    const resetField = () => {
      state.crops = [];
      state.particles = [];
      for (let i = 0; i < 18; i += 1) {
        spawnCrop();
      }
      state.harvested = 0;
      state.combo = 0;
      updateStats();
    };

    const updateStats = () => {
      statHarvested.textContent = state.harvested;
      statCombo.textContent = state.combo;
    };

    const createParticles = (x, y, color) => {
      for (let i = 0; i < 12; i += 1) {
        state.particles.push({
          x,
          y,
          vx: (Math.random() - 0.5) * 4,
          vy: (Math.random() - 0.8) * 4,
          life: 40 + Math.random() * 20,
          color,
        });
      }
    };

    const drawBackground = () => {
      ctx.fillStyle = "#d2f3ff";
      ctx.fillRect(0, 0, field.width, field.height);

      ctx.fillStyle = "#8fda7f";
      ctx.fillRect(0, field.height * 0.15, field.width, field.height * 0.85);

      ctx.fillStyle = "rgba(255, 255, 255, 0.55)";
      ctx.beginPath();
      ctx.ellipse(140, 120, 70, 30, 0, 0, Math.PI * 2);
      ctx.ellipse(220, 115, 70, 30, 0, 0, Math.PI * 2);
      ctx.fill();

      ctx.fillStyle = "rgba(255, 255, 255, 0.45)";
      ctx.beginPath();
      ctx.ellipse(640, 90, 80, 32, 0, 0, Math.PI * 2);
      ctx.ellipse(720, 100, 60, 28, 0, 0, Math.PI * 2);
      ctx.fill();

      ctx.fillStyle = "#6bb867";
      for (let i = 0; i < 12; i += 1) {
        ctx.fillRect(0, field.height * 0.2 + i * 40, field.width, 18);
      }
    };

    const drawCrop = (crop, time) => {
      const bob = Math.sin(time / 500 + crop.bobOffset) * 2;
      const highlight = state.hoveredCrop && state.hoveredCrop.id === crop.id;
      const soilY = crop.y + crop.size + 10;

      ctx.fillStyle = "#9b5d3b";
      ctx.beginPath();
      ctx.ellipse(crop.x, soilY, crop.size * 1.2, crop.size * 0.6, 0, 0, Math.PI * 2);
      ctx.fill();

      ctx.fillStyle = crop.type.color;
      ctx.beginPath();
      ctx.ellipse(crop.x, crop.y + bob, crop.size, crop.size * 1.3, 0, 0, Math.PI * 2);
      ctx.fill();

      ctx.strokeStyle = crop.type.stem;
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.moveTo(crop.x, crop.y - crop.size * 0.9 + bob);
      ctx.lineTo(crop.x, crop.y - crop.size * 1.6 + bob);
      ctx.stroke();

      ctx.fillStyle = crop.type.stem;
      ctx.beginPath();
      ctx.ellipse(crop.x - 6, crop.y - crop.size * 1.6 + bob, 8, 4, -0.4, 0, Math.PI * 2);
      ctx.ellipse(crop.x + 6, crop.y - crop.size * 1.6 + bob, 8, 4, 0.4, 0, Math.PI * 2);
      ctx.fill();

      if (highlight) {
        ctx.strokeStyle = "rgba(255, 255, 255, 0.9)";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.arc(crop.x, crop.y + bob, crop.size * 1.4, 0, Math.PI * 2);
        ctx.stroke();
      }
    };

    const drawParticles = () => {
      state.particles.forEach((particle) => {
        ctx.fillStyle = particle.color;
        ctx.globalAlpha = Math.max(0, particle.life / 60);
        ctx.beginPath();
        ctx.arc(particle.x, particle.y, 3, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
      });
    };

    const updateParticles = () => {
      state.particles = state.particles.filter((particle) => particle.life > 0);
      state.particles.forEach((particle) => {
        particle.x += particle.vx;
        particle.y += particle.vy;
        particle.vy += 0.08;
        particle.life -= 1;
      });
    };

    const render = (time) => {
      drawBackground();
      state.crops.forEach((crop) => drawCrop(crop, time));
      drawParticles();
      updateParticles();
      requestAnimationFrame(render);
    };

    const harvestCrop = (crop) => {
      const now = Date.now();
      const timeSince = now - state.lastHarvestTime;
      state.lastHarvestTime = now;
      state.combo = timeSince < 1500 ? Math.min(state.combo + 1, 9) : 0;
      const comboBonus = crop.type.golden ? 2 : 0;
      const points = crop.type.value + comboBonus;
      state.harvested += points;
      updateStats();
      createParticles(crop.x, crop.y, crop.type.color);
      showToast(`${crop.type.name} +${points}`);
      state.crops = state.crops.filter((item) => item.id !== crop.id);
      spawnCrop();
    };

    const getCropAt = (x, y) => {
      return state.crops.find((crop) => {
        const dx = x - crop.x;
        const dy = y - crop.y;
        return Math.sqrt(dx * dx + dy * dy) < crop.size * 1.2;
      });
    };

    const scalePoint = (event) => {
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      return {
        x: (event.clientX - rect.left) * scaleX,
        y: (event.clientY - rect.top) * scaleY,
      };
    };

    canvas.addEventListener("pointermove", (event) => {
      const point = scalePoint(event);
      state.hoveredCrop = getCropAt(point.x, point.y);
    });

    canvas.addEventListener("pointerleave", () => {
      state.hoveredCrop = null;
    });

    canvas.addEventListener("pointerdown", (event) => {
      if (state.showSplash) {
        return;
      }
      const point = scalePoint(event);
      const crop = getCropAt(point.x, point.y);
      if (crop) {
        harvestCrop(crop);
      }
    });

    startBtn.addEventListener("click", () => {
      state.showSplash = false;
      splash.style.display = "none";
    });

    howBtn.addEventListener("click", () => {
      state.showSplash = false;
      splash.style.display = "none";
      showToast("Click crops to pull them up!");
    });

    resetBtn.addEventListener("click", () => {
      resetField();
      showToast("Fresh soil, fresh crops!");
    });

    resetField();
    requestAnimationFrame(render);
  </script>
</body>
</html>
